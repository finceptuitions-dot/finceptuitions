<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Past Papers</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f0f8ff; }
header { background:#0B3D91; color:white; padding:15px 20px; display:flex; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,0.2); position:relative; }
header h1 { margin:0; font-size:1.5em; flex-grow:1; text-align:center; }
.back-btn { position:absolute; left:15px; background:none; border:none; font-size:24px; cursor:pointer; color:white; }

.container { max-width:900px; margin:20px auto; display:grid; grid-template-columns:1fr 1fr; gap:15px; padding:0 10px; }

.card { background:white; padding:20px; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.15); text-align:center; font-weight:bold; color:#0B3D91; cursor:pointer; transition:transform 0.2s, background 0.2s; }
.card:hover { transform:translateY(-3px); background:#e6f2ff; }

#viewer { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:1000; flex-direction:column; justify-content:center; align-items:center; }
#viewer button { position:absolute; top:20px; right:20px; font-size:28px; background:none; border:none; color:white; cursor:pointer; }
#viewer iframe { width:90%; height:90vh; border:none; border-radius:8px; }
</style>
</head>
<body>

<header>
<button class="back-btn" onclick="goBack()">&#8592;</button>
<h1>Past Papers</h1>
</header>

<div id="mainContainer" class="container"></div>

<!-- Full screen viewer -->
<div id="viewer">
  <button onclick="closeViewer()">&times;</button>
  <iframe id="paperFrame"></iframe>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCBFObaNdHuPDVM3eo-1qtJ0ENQ3vf1oOc",
  authDomain: "finceponlinetuitions.firebaseapp.com",
  projectId: "finceponlinetuitions",
  storageBucket: "finceponlinetuitions.appspot.com",
  messagingSenderId: "562071475466",
  appId: "1:562071475466:web:182cb7c22b64729dd16f3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selectedSubject = null;
let selectedYear = null;
let papersData = []; // all past papers

const container = document.getElementById("mainContainer");

// Step: Show Subjects first
const subjects = ["Math","English","Physics","Chemistry","Biology","Economics"];
const years = ["2026","2025","2024","2023","2022"]; // you can expand

function showSubjects(){
  container.innerHTML = "";
  subjects.forEach(sub => {
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = sub;
    card.onclick = () => {
      selectedSubject = sub;
      showYears();
    };
    container.appendChild(card);
  });
}

function showYears(){
  container.innerHTML = "";
  // collect years available for selected subject
  let subjectPapers = papersData.filter(p => p.subject === selectedSubject);
  let availableYears = [...new Set(subjectPapers.map(p => p.year))].sort((a,b)=>b-a); // descending

  availableYears.forEach(yr => {
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = yr;
    card.onclick = () => {
      selectedYear = yr;
      showFiles();
    };
    container.appendChild(card);
  });
}

function showFiles(){
  container.innerHTML = "";
  let files = papersData.filter(p => p.subject === selectedSubject && p.year === selectedYear);
  if(files.length === 0){
    container.innerHTML = "<p>No papers found.</p>";
    return;
  }

  files.forEach(f => {
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = f.title;
    card.onclick = () => openViewer(f.link);
    container.appendChild(card);
  });
}

// Fetch all papers once
db.collection("past papers").get().then(snapshot=>{
  papersData = [];
  snapshot.forEach(doc => papersData.push(doc.data()));
  showSubjects();
}).catch(err => {
  container.innerHTML = "<p style='color:red;'>Error fetching papers: "+err+"</p>";
});

// Back button logic
function goBack(){
  if(selectedYear){ selectedYear=null; showYears(); }
  else if(selectedSubject){ selectedSubject=null; showSubjects(); }
  else { history.back(); }
}

// Viewer
function openViewer(link){
  document.getElementById("viewer").style.display = "flex";
  document.getElementById("paperFrame").src = link.replace("/view?usp=sharing","/preview");
}
function closeViewer(){
  document.getElementById("viewer").style.display = "none";
  document.getElementById("paperFrame").src = "";
}
</script>

</body>
</html>