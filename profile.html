<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile - Finceptuitions</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2575fc">
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    color: #1e3a8a;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
header {
    background-color: #1e3a8a;
    color: white;
    text-align: center;
    padding: 20px 0;
}
.container {
    max-width: 600px;
    margin: 20px auto;
    padding: 0 15px;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.section {
    background-color: white;
    margin-bottom: 20px;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.section h2 {
    margin-top: 0;
}
.back-btn {
    margin: 10px 0;
    padding: 8px 15px;
    background: #1e3a8a; 
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}
.back-btn:hover {
    background-color: #334155;
}
</style>
</head>
<body>

<header>
    <h1>User Profile</h1>
</header>

<div class="container">
    <button onclick="history.back()" class="back-btn">‚Üê Back</button>

    <div class="section">
        <h2>Personal Information</h2>
        <p><strong>Name:</strong> <span id="profile-name">Loading...</span></p>
        <p><strong>Email:</strong> <span id="profile-email">Loading...</span></p>
        <p><strong>Member since:</strong> <span id="profile-since">Loading...</span></p>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// Firebase config (corrected storageBucket)
const firebaseConfig = {
  apiKey: "AIzaSyC6gaEIKoeZmSRwVVJOrkQtk7SW_iiqz04",
  authDomain: "secondary-school-center.firebaseapp.com",
  projectId: "secondary-school-center",
  storageBucket: "secondary-school-center.appspot.com",
  messagingSenderId: "156434969933",
  appId: "1:156434969933:web:796b926798647d1ada3304",
  measurementId: "G-G70CP4W5F8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// HTML elements
const nameEl = document.getElementById('profile-name');
const emailEl = document.getElementById('profile-email');
const sinceEl = document.getElementById('profile-since');

onAuthStateChanged(auth, (user) => {
    console.log("Current user:", user); // Debug

    if (!user) {
        // User not signed in
        nameEl.textContent = "Not signed in";
        emailEl.textContent = "-";
        sinceEl.textContent = "-";
        return;
    }

    // User is signed in, fetch data from Firestore in real-time
    const docRef = doc(db, "users", user.uid);
    onSnapshot(docRef, (docSnap) => {
        if (docSnap.exists()) {
            const data = docSnap.data();
            nameEl.textContent = data.name || "No name";
            emailEl.textContent = data.email || user.email || "No email";
            sinceEl.textContent = data.memberSince || "Unknown";
        } else {
            nameEl.textContent = "User data not found";
            emailEl.textContent = "-";
            sinceEl.textContent = "-";
        }
    }, (error) => {
        console.error("Error fetching user data:", error);
        nameEl.textContent = "Error loading profile";
        emailEl.textContent = "-";
        sinceEl.textContent = "-";
    });
});
</script>

<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
    .then(() => console.log("Service Worker registered"))
    .catch((err) => console.log("SW registration failed:", err));
}
</script>

</body>
</html>