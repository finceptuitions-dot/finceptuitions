<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documents</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f0f8ff; }
header { background:#0B3D91; color:white; padding:15px 20px; display:flex; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
header h1 { margin:0; font-size:1.5em; flex-grow:1; text-align:center; }
.back-symbol { font-size:1.4em; cursor:pointer; margin-right:10px; user-select:none; }

.container { max-width:800px; margin:20px auto; display:grid; grid-template-columns:repeat(2,1fr); gap:16px; }

.button { display:flex; align-items:center; justify-content:center; background:white; color:#0B3D91; padding:20px; border:none; border-radius:12px; cursor:pointer; font-size:16px; font-weight:bold; text-align:center; box-shadow:0 3px 8px rgba(0,0,0,0.15); transition: transform 0.2s, background 0.2s; }
.button:hover { transform:translateY(-3px); background:#e6f2ff; }

.file-card { display:flex; justify-content:flex-start; align-items:center; background:white; color:#0B3D91; padding:15px 20px; margin:6px 0; border:none; border-radius:12px; cursor:pointer; font-size:16px; font-weight:bold; box-shadow:0 3px 8px rgba(0,0,0,0.15); transition: transform 0.2s, background 0.2s; grid-column:1 / -1; }
.file-card:hover { transform:translateY(-2px); background:#e6f2ff; }

#previewContainer { width:100%; height:100vh; position:fixed; top:0; left:0; background:white; display:none; z-index:1000; }
#previewContainer iframe { width:100%; height:100%; border:none; }
#closePreview { position:absolute; top:10px; right:10px; background:#f44336; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; z-index:1001; }
#closePreview:hover { background:#d32f2f; }
</style>
</head>
<body>

<header>
<span id="backBtn" class="back-symbol" style="display:none;">←</span>
<h1>Fincep</h1>
</header>

<div class="container" id="content"></div>

<div id="previewContainer">
<button id="closePreview">Close ✖</button>
<iframe id="previewIframe"></iframe>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCBFObaNdHuPDVM3eo-1qtJ0ENQ3vf1oOc",
  authDomain: "finceponlinetuitions.firebaseapp.com",
  projectId: "finceponlinetuitions",
  storageBucket: "finceponlinetuitions.appspot.com",
  messagingSenderId: "562071475466",
  appId: "1:562071475466:web:182cb7c22b64729dd16f3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selectedSubject=null, selectedGrade=null, selectedTerm=null;
const content=document.getElementById("content");
const previewContainer=document.getElementById("previewContainer");
const previewIframe=document.getElementById("previewIframe");
const closePreview=document.getElementById("closePreview");
const backBtn=document.getElementById("backBtn");

closePreview.onclick=()=>{ previewContainer.style.display='none'; previewIframe.src=''; };

backBtn.onclick=()=>{
    if(selectedTerm){ selectedTerm=null; loadTerms(); }
    else if(selectedGrade){ selectedGrade=null; loadGrades(); }
    else if(selectedSubject){ selectedSubject=null; loadSubjects(); }
    backBtn.style.display=(selectedSubject||selectedGrade||selectedTerm)?'inline-block':'none';
};

// --- Load Steps ---
function loadSubjects(){
    content.innerHTML=""; backBtn.style.display='none';
    db.collection("documents").get().then(snapshot=>{
        const subjects=[...new Set(snapshot.docs.map(doc=>doc.data().subject))];
        subjects.forEach(sub=>{
            const btn=document.createElement("button");
            btn.className="button"; btn.textContent=sub;
            btn.onclick=()=>{ selectedSubject=sub; loadGrades(); };
            content.appendChild(btn);
        });
    });
}

function loadGrades(){
    content.innerHTML=""; backBtn.style.display='inline-block';
    db.collection("documents").where("subject","==",selectedSubject).get().then(snapshot=>{
        const grades=[...new Set(snapshot.docs.map(doc=>doc.data().grade))];
        grades.forEach(grade=>{
            const btn=document.createElement("button");
            btn.className="button"; btn.textContent=`Grade ${grade}`;
            btn.onclick=()=>{ selectedGrade=grade; loadTerms(); };
            content.appendChild(btn);
        });
    });
}

function loadTerms(){
    content.innerHTML=""; backBtn.style.display='inline-block';
    db.collection("documents").where("subject","==",selectedSubject).where("grade","==",selectedGrade)
      .get().then(snapshot=>{
        const terms=[...new Set(snapshot.docs.map(doc=>doc.data().term))];
        terms.forEach(term=>{
            const btn=document.createElement("button");
            btn.className="button"; btn.textContent=`Term ${term}`;
            btn.onclick=()=>{ selectedTerm=term; loadFiles(); };
            content.appendChild(btn);
        });
    });
}

function loadFiles(){
    content.innerHTML=""; backBtn.style.display='inline-block';
    db.collection("documents").where("subject","==",selectedSubject)
      .where("grade","==",selectedGrade)
      .where("term","==",selectedTerm)
      .get().then(snapshot=>{
        snapshot.docs.forEach(doc=>{
            const data=doc.data();
            const card=document.createElement("div");
            card.className="file-card"; card.textContent=data.title;
            card.onclick=()=>{
                const id=extractDriveId(data.link);
                if(id){ previewIframe.src=`https://drive.google.com/file/d/${id}/preview`; previewContainer.style.display='block'; }
                else{ alert("Invalid link"); }
            };
            content.appendChild(card);
        });
    });
}

function extractDriveId(url){ const id=url.match(/[-\w]{25,}/); return id? id[0]:""; }

loadSubjects();
</script>
</body>
</html>